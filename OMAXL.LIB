(LOOP THROUGH ALL INSERTS AND SET THE HIGHEST AS VTLCN HEIGHT)
OMAXL

(MACHINE: MU6300V-L - OSP P500)
(TOUCH SETTER: RIGHT ANGLE STYLE)
(PROGRAMMER: JUSTIN BROWN)
(REV: 0)
(DATE: 07/27/2024)

(TO CALL THIS PROGRAM:)
  (VARIABLES:)
    (SET VC#'S W/ HEIGHTS TO COMPARE)
    (PSRT = START VC#)
    (PEND = STOP VC#)
  (CALL:)
    (CALL OMAXL PSRT=PSRT PEND=PEND)

(CHECK PASSED VARIABLES)
    IF [PSRT EQ EMPTY] NALM1
    IF [PEND EQ EMPTY] NALM2
    IF [PSRT GT PEND] NALM3
    IF [PSRT LT 1] NALM4
    IF [PEND GT 1000] NALM5


(INFINITE LOOP)
 (PRE-SET VARIABLES)
    PNTR = PSRT (SET POINTER TO VC# START)
    HIGH = 0

(LOOP UNTIL ALL INSERTS COMPARED)
DO 1
    IF [ [PNTR + 1] GT PEND] NBREAK (BREAK IF NEXT POINTER PASSED PEND)

    (EXTRACT INSERT HEIGHT FROM VC#'S)
    HCUR = VC[PNTR] (ACTUAL INSERT HEIGHT)
    HNXT = VC[PNTR + 1] (NEXT INSERT HEIGHT)
    
    NCHK1
        (IF "HCUR" IS SMALL -- CHECK "HNXT")
        IF [ HCUR LT HIGH ] NCHK2
        HIGH = HCUR ("HCUR" WAS HIGHER THAN "HIGH")

    NCHK2
        (IF "HNXT" IS SMALL -- MOVE ON TO NEXT SET)
        IF [ HNXT LT HIGH ] NPNTR
        HIGH = HNXT ("HNXT" WAS HIGHER THAN "HIGH")

    NPNTR
    PNTR = [PNTR + 1] (UPDATE POINTER TO NEXT INSERT)

END 1
NBREAK (BREAK INF. LOOP)

(VALIDATE LOOP RAN CORRECTLY)
    IF [HIGH EQ EMPTY ] NALM6

(SET ACTIVE TOOL LENGTH AS HIGHEST FOUND INSERT)
    G4 F2.
    VTOHT[[VTLCN] , 10001] = [HIGH] 
    GOTO NEND

(ALARMS)
    NALM1
    VUACM[1]='PSRT IS MISSING'
    VDOUT[993]=9001
    NALM2
    VUACM[1]='PEND IS MISSING'
    VDOUT[993]=9001
    NALM3
    VUACM[1]='PSRT GT PEND'
    VDOUT[993]=9001
    NALM4
    VUACM[1]='PRST LESS THAN 1'
    VDOUT[993]=9001
    NALM5
    VUACM[1]='PEND OVER 1000'
    VDOUT[993]=9001
    ("HIGH" RETURNED EMPTY VALUE - LOOP WAS NOT RUN)
    NALM6
    VUACM[1]='HIGHEST = EMPTY'
    VDOUT[993]=9001


NEND
RTS
